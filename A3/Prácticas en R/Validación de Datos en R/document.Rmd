---
title: 'Practical 4: Visualisation using qplot()'
author: "Laura Rodriguez Navas"
date: "February 2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
```

Keratoconus is a disorder that affects the cornea through an abnormal growth of collagen fibres. This makes the cornea become conical with an important vision loss. There are many possible treatments, but one common solution is the insertion of intrastromal corneal ring segments, such that the cornea is flattened.

The file “queratocono.csv” includes information about 394 patients with Keratoconus who were treated with ring placement. The variables that were recorded are:

1. K1: keratometry or main corneal curvature.
2. K2: perpendicular curvature to K1.
3. Ch: corneal hysteresis.
4. Na: number of rings (1 or 2).
5. Incision: angle in which the cornea is cut.
6. Prof: depth of the incision.
7. Diam: diameter of the incision.
8. Grosor: Incision thickness.
9. Longitud1: Angle of placement of the first ring (surgical parameter).
10. Longitud2: Angle of placement of the second ring (surgical parameter).
11. grosor1: Thickness of the first ring.
12. grosor2: Thickness of the second ring.
13. long1: arc length of the first ring.
14. long2: arc length of the second ring.
15. K1.salida: keratometry or main corneal curvature after the placement of the ring(s).
16. Astig: astigmatism curvature after the placement of the ring(s) (K1.salida – K2.salida).

```{r}
queratocono <- read.csv("Queratocono.csv", header=TRUE, sep=",")
str(queratocono)
any(is.na(queratocono))
```

In order to analyse the information in a visual way:

1. Study the relation between K1 and K2 with smoother (by default and using linear regression).

```{r}
qplot(queratocono$K1, queratocono$K2, data = queratocono, xlab = "K1", ylab = "K2", 
  main = "Relation between K1 and K2") +
  geom_point() + 
  geom_smooth() +
  

qplot(queratocono$K1, queratocono$K2, data = queratocono, xlab = "K1", ylab = "K2") +
  geom_point() +
  geom_smooth(method = lm)
```

2. Study the relation between K1 and K2 distinguishing by factor na, according to what is shown in Figure 2 (note the title).

```{r}
qplot(queratocono$K1, queratocono$K2, data = queratocono, xlab = "K1", ylab = "K2",      color=factor(na)) +
  geom_point() +
  geom_smooth(method = lm)
```


3. Study the relation between K1 and K1.salida (see Figure 3).

4. Build a histogram in terms of grosor (note that grosor should be taken as a factor) of the inserted ring (see Figure 4).

5. Build a scatter plot of the relation between K1 and K2 with “faceting” in terms of the parameters diam and na, by assigning different colours to the points according to the thickness (grosor) of the ring. In order to visualise all points correctly use a transparency of value 1/3 (see Figure 5).

6. Create two boxplots that show a summary of the distributions of K1 and K2 (separately) with respect to the thickness (grosor) as shown Figure 6.