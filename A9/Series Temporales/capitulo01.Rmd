---
author: "Laura Rodríguez Navas"
date: "`r format(Sys.time(), '%B, %Y')`"
documentclass: book
principal: yes
forprint: false
fontsize: 11pt
geometry: margin = 2.5cm
bibliography: bib/library.bib
metodobib: yes
biblio-style: plainnat
csl: methods-in-ecology-and-evolution.csl
link-citations: yes
output:
  html_document: 
    toc: yes
    fig_caption: yes
  pdf_document:
    keep_tex: no
    number_sections: yes
    citation_package: natbib
    fig_caption: yes
    template: latex/template.tex
---


```{r include=FALSE}
knitr::opts_chunk$set(fig.path = 'figurasR/',
                      echo = TRUE, warning = FALSE, message = FALSE,
                      fig.pos = "H",fig.align = "center", out.width = "95%",
                      cache=FALSE)
```

<!-- \setcounter{chapter}{2} -->
<!-- \setcounter{chapter}{2} escribir 2 para capítulo 3  -->
<!-- \pagenumbering{arabic} -->

\ifdefined\ifprincipal
\else
\setlength{\parindent}{1em}
\pagestyle{fancy}
\setcounter{tocdepth}{4}
\tableofcontents
<!-- \nocite{*} -->
\fi

\ifdefined\ifdoblecara
\fancyhead{}{}
\fancyhead[LE,RO]{\scriptsize\rightmark}
\fancyfoot[LO,RE]{\scriptsize\slshape \leftmark}
\fancyfoot[C]{}
\fancyfoot[LE,RO]{\footnotesize\thepage}
\else
\fancyhead{}{}
\fancyhead[RO]{\scriptsize\rightmark}
\fancyfoot[LO]{\scriptsize\slshape \leftmark}
\fancyfoot[C]{}
\fancyfoot[RO]{\footnotesize\thepage}
\fi
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

# Análisis de la serie temporal

## Introducción

Una empresa tecnológica cuya área de negocio es la inteligencia artificial es contratada por una empresa eléctrica para que diseñe un sistema de recomendación que haga ofertas personalizadas a sus clientes sobre los paquetes energéticos más adecuados a sus consumos. Para ello, la empresa primero debe llevar a cabo un análisis exhaustivo de los consumos energéticos y diseñar una técnica de predicción que sea capaz de predecir dichos consumos con un horizonte temporal dado. La empresa eléctrica suministra a la empresa tecnológica para dicho cometido los consumos eléctricos desde el 01 de enero de 2015 hasta el 31 de diciembre de 2015 medidos con una frecuencia temporal de 10 minutos.

Se pide:

1. Analizar la serie temporal de consumos eléctricos y describir brevemente las principales características de esta.

2. Realizar un estudio para determinar si la serie temporal presenta *outliers*. Describir brevemente el estudio realizado y las conclusiones alcanzadas.

3. Seleccionar un artículo publicado en una revista científica de prestigio internacional en el que se presente un método de predicción. Estudiar de manera detallada el método publicado y describirlo de forma resumida.

4. Aplicar el método seleccionado en el apartado anterior para obtener una predicción del consumo eléctrico con un horizonte temporal de 4 horas para los días de la semana desde el lunes 8 de junio hasta el domingo 14 de junio. Para ello, se debe implementar un método de predicción en el lenguaje de programación que se estime oportuno o bien usar software libre disponible como WEKA, R, KEEL, etc. Una vez obtenidas las predicciones del periodo indicado, visualizar los resultados (predicciones, errores, etc.).

Se utilizarán los siguientes paquetes adicionales, para los apartados de a continuación.


```{r warning=FALSE}
library(tidyverse)
library(ggplot2)
library(lubridate)
library(xts)
library(forecast)
```


## Formatear la serie temporal


```{r}
data <- read.csv("Demanda_2015.csv", header = FALSE, sep = ",")

# 
colnames(data) <- c("date", "time", "demand")

#
head(data, 10)

#
summary(data)
```

Tenemos la variable *date* como *character*, la variable *time* como *character* y la variable *demand* como *integer.*


```{r}
sum(is.na(data))
```


```{r warning=FALSE}
#
data <- cbind(datetime = paste(data$date, data$time), data)
data$datetime <- parse_date_time(data$datetime, "dmY HMS", 
                                 truncated = 3, tz = "UTC")
#
data$date <- NULL
data$time <- NULL

#
head(data, 10)
```


## Tipo de serie temporal


```{r warning=FALSE}
ggplot(data = data, aes(x = datetime, y = demand)) +
  geom_line() + 
  geom_smooth(method = "loess", se = FALSE, span = 0.6) +
  scale_x_datetime(date_labels = "%b", breaks = "1 month", 
                   expand = c(0, 0)) +
  ggtitle("Consumo eléctrico, 2015") +
  xlab("Mes") +
  ylab("Demanda en MW")
```

Como podemos observar, el consumo de energía eléctrica aumenta tanto en los meses de verano como en los meses de invierno. Esto se debe a que las personas usan la electricidad para enfriar y calentar sus viviendas respectivamente.

```{r}
#
data$month <- format(data$datetime, format = "%B")

#
ggplot(data, aes(x = datetime, y = demand)) +
  geom_line(aes(colour = month)) +
  geom_smooth(method = "loess", se = FALSE, span = 0.6) +
  scale_x_datetime(date_labels = "%b", breaks = "1 month", 
                   expand = c(0, 0)) +
  ggtitle("Consumo eléctrico, 2015") +
  xlab("Mes") +
  ylab("Demanda en MW") +
  theme(legend.position = "none")

#
data$month <- NULL
```


## Componentes de la serie temporal

```{r}
#
ts <- ts(data$demand, frequency = 24*60/10)
acf(ts)
pacf(ts)
mstl(ts, lambda = "auto") %>% autoplot(facet = TRUE)
```

